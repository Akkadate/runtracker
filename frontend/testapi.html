<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ทดสอบ API อย่างละเอียด</title>
    <style>
        body { font-family: 'Prompt', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { padding: 8px; width: 100%; box-sizing: border-box; }
        button { padding: 10px 15px; background: #06c755; color: white; border: none; cursor: pointer; }
        #result { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; display: none; }
        pre { background: #fff; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>ทดสอบ API อัปโหลดข้อมูลการวิ่ง</h1>
    
    <div class="form-group">
        <label>User ID:</label>
        <input type="text" id="userid" value="Ub675007fdfb3df25423a682dc2f0944d">
    </div>
    
    <div class="form-group">
        <label>วันที่วิ่ง:</label>
        <input type="date" id="rundate" value="2025-05-03">
    </div>
    
    <div class="form-group">
        <label>ระยะทาง (กิโลเมตร):</label>
        <input type="number" id="distance" value="5" step="0.01">
    </div>
    
    <div class="form-group">
        <label>เวลาที่ใช้ (นาที):</label>
        <input type="number" id="duration" value="30" step="0.01">
    </div>
    
    <div class="form-group">
        <label>รูปภาพหลักฐาน:</label>
        <input type="file" id="file" accept="image/*">
    </div>
    
    <button id="submitBtn">ทดสอบส่งข้อมูล</button>
    
    <div id="result">
        <h3>ผลลัพธ์:</h3>
        <div id="status"></div>
        <pre id="response"></pre>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // กำหนดค่าเริ่มต้น
            document.getElementById('rundate').value = new Date().toISOString().split('T')[0];
            
            // เพิ่ม event listener ให้กับปุ่มส่งข้อมูล
            document.getElementById('submitBtn').addEventListener('click', async function() {
                // รับค่าจากฟอร์ม
                const userid = document.getElementById('userid').value;
                const rundate = document.getElementById('rundate').value;
                const distance = document.getElementById('distance').value;
                const duration = document.getElementById('duration').value;
                const fileInput = document.getElementById('file');
                
                // ตรวจสอบข้อมูล
                if (!userid || !rundate || !distance || !duration || !fileInput.files[0]) {
                    alert('กรุณากรอกข้อมูลให้ครบถ้วน');
                    return;
                }
                
                try {
                    // สร้าง FormData
                    const formData = new FormData();
                    formData.append('userid', userid);
                    formData.append('rundate', rundate);
                    formData.append('distance', distance);
                    formData.append('duration', duration);
                    formData.append('file', fileInput.files[0]);
                    
                    // แสดงข้อมูลที่จะส่ง
                    console.log('Sending data:');
                    for (let [key, value] of formData.entries()) {
                        if (key === 'file') {
                            console.log(`${key}: ${value.name} (${value.type}, ${value.size} bytes)`);
                        } else {
                            console.log(`${key}: ${value}`);
                        }
                    }
                    
                    // ส่งข้อมูล
                    const response = await fetch('https://runtracker.devapp.cc/api/runs/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    // รับข้อมูลตอบกลับเป็นข้อความ
                    const responseText = await response.text();
                    
                    // แสดงผลลัพธ์
                    document.getElementById('status').textContent = `สถานะ: ${response.status} ${response.statusText}`;
                    document.getElementById('response').textContent = responseText;
                    document.getElementById('result').style.display = 'block';
                    
                    // แจ้งเตือนสถานะ
                    if (response.ok) {
                        alert('ส่งข้อมูลสำเร็จ!');
                    } else {
                        alert(`เกิดข้อผิดพลาด: ${response.status} ${response.statusText}`);
                    }
                } catch (error) {
                    // แสดงข้อผิดพลาด
                    document.getElementById('status').textContent = 'เกิดข้อผิดพลาด';
                    document.getElementById('response').textContent = error.toString();
                    document.getElementById('result').style.display = 'block';
                    alert(`เกิดข้อผิดพลาด: ${error.message}`);
                }
            });
        });
    </script>
</body>
</html>
